<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>案件詳細</title>
    <link rel="stylesheet" href="./style.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Config (index.html と同じ値を貼り付けてください)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function fetchCaseDetails() {
            // URLクエリパラメータから company, thread を取得
            const params = new URLSearchParams(window.location.search);
            const companyId = params.get('company');
            const threadId = params.get('thread');

            if (!companyId || !threadId) {
                console.error("Missing parameters. company or thread ID not found.");
                document.getElementById("caseDetails").innerHTML = "パラメータが不足しています。";
                return;
            }

            try {
                // Firestore から案件詳細を取得
                const docRef = db
                  .collection("companies")
                  .doc(companyId)
                  .collection("threads")
                  .doc(threadId);

                const docSnap = await docRef.get();

                if (!docSnap.exists) {
                    document.getElementById("caseDetails").innerHTML = "該当案件が見つかりません。";
                    return;
                }

                // 取得したデータ
                const data = docSnap.data();

                // 必要に応じて表示する項目を増やす
                const detailHTML = `
                    <h2>案件詳細</h2>
                    <p>販売店番号: ${companyId}</p>
                    <p>団体名: ${data.groupName || "不明"}</p>
                    <p>依頼日: ${data.requestDate || "-"}</p>
                    <p>メモ: ${data.remarks || "-"}</p>
                `;
                document.getElementById("caseDetails").innerHTML = detailHTML;
            } catch (error) {
                console.error("案件詳細の取得に失敗しました", error);
                document.getElementById("caseDetails").innerHTML = "案件詳細の取得に失敗しました。";
            }
        }

        window.onload = fetchCaseDetails;
    </script>
</head>
<body>
    <h1>案件詳細ページ</h1>
    <div id="caseDetails">読み込み中…</div>
</body>
</html>
